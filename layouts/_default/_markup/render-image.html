{{- $url := .Destination -}}
{{- $u := urls.Parse $url -}}
{{- if not $u.IsAbs -}}
    {{- if strings.HasPrefix $url "/" -}}
        {{- $url = (print .Page.Site.BaseURL (strings.TrimPrefix "/" $url)) -}}
    {{- else -}}
        {{- $url = (print .Page.Permalink $url) -}}
    {{- end -}}
{{- end -}}
<a href="{{ $url | safeURL }}">
    <img src="{{ $url | safeURL }}" alt="{{ .Text }}" {{ with .Title }} title="{{ . }}"{{ end }} />
</a>
